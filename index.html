<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Huanta Comunidad - La Esmeralda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background-image: url('https://images.unsplash.com/photo-1533900298318-6b8da08a523e?auto=format&fit=crop&q=80&w=1000');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .sticker-btn {
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .sticker-btn:active { transform: scale(0.95); }
    </style>
</head>
<body class="min-h-screen">
    <header class="bg-green-700 text-white p-4 shadow-lg sticky top-0 z-50 text-center">
        <h1 class="text-xl font-bold uppercase tracking-wider">Huanta Comunidad</h1>
        <p class="text-xs opacity-90">La Esmeralda de los Andes</p>
    </header>

    <div class="flex gap-2 p-3 overflow-x-auto bg-white/50 backdrop-blur-md">
        <button onclick="setCity('Huanta')" class="bg-green-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow">Huanta</button>
        <button onclick="setCity('Huamanga')" class="bg-white text-gray-700 border px-4 py-1 rounded-full text-sm font-bold shadow">Huamanga</button>
        <button onclick="setCity('Sivia')" class="bg-white text-gray-700 border px-4 py-1 rounded-full text-sm font-bold shadow">Sivia</button>
        <button onclick="setCity('VRAEM')" class="bg-white text-gray-700 border px-4 py-1 rounded-full text-sm font-bold shadow">VRAEM</button>
        <span class="text-2xl">ğŸš¨</span>
    </div>

    <main class="max-w-md mx-auto p-4 pb-32">
        <div id="chat-container" class="space-y-4 mb-6">
            </div>

        <div class="grid grid-cols-4 gap-2 mb-4">
            <button onclick="addSticker('ğŸ’° Oferta')" class="sticker-btn bg-white p-2 rounded-lg text-xs font-bold border border-green-200">ğŸ’° Oferta</button>
            <button onclick="addSticker('ğŸ¡ Terreno')" class="sticker-btn bg-white p-2 rounded-lg text-xs font-bold border border-green-200">ğŸ¡ Terreno</button>
            <button onclick="addSticker('â­ GarantÃ­a')" class="sticker-btn bg-white p-2 rounded-lg text-xs font-bold border border-green-200">â­ GarantÃ­a</button>
            <button onclick="addSticker('ğŸ“‰ Rebaja')" class="sticker-btn bg-white p-2 rounded-lg text-xs font-bold border border-green-200">ğŸ“‰ Rebaja</button>
        </div>

        <div class="fixed bottom-0 left-0 right-0 p-4 glass-card border-t rounded-t-3xl shadow-2xl">
            <div class="max-w-md mx-auto space-y-2">
                <div class="flex gap-2">
                    <input id="userInput" type="text" placeholder="Tu Nombre" class="w-1/2 p-2 rounded-xl border focus:ring-2 focus:ring-green-500 outline-none text-sm">
                    <select id="typeInput" class="w-1/2 p-2 rounded-xl border text-sm font-bold bg-white">
                        <option value="Venta">ğŸ’° Venta</option>
                        <option value="Compra">ğŸ›’ Compra</option>
                        <option value="Servicio">ğŸ› ï¸ Servicio</option>
                    </select>
                </div>
                <input id="phoneInput" type="tel" placeholder="WhatsApp (Ej: 987654321)" class="w-full p-2 rounded-xl border text-sm">
                <textarea id="messageInput" placeholder="Escribe tu oferta aquÃ­..." class="w-full p-2 rounded-xl border h-16 text-sm outline-none"></textarea>
                <button onclick="sendMsg()" id="sendBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl transition-all shadow-lg active:scale-95">
                    PUBLICAR AHORA
                </button>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, Timestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIGURACIÃ“N DE TU FIREBASE (COPIADA DE TU IMAGEN)
        const firebaseConfig = {
            apiKey: "AIzaSyDE-...", 
            authDomain: "huanta-comunidad.firebaseapp.com",
            projectId: "huanta-comunidad",
            storageBucket: "huanta-comunidad.appspot.com",
            messagingSenderId: "572754145420",
            appId: "1:572754145420:web:443f6562548858f967f650"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let currentCity = 'Huanta';

        window.setCity = (city) => { currentCity = city; alert('Ciudad seleccionada: ' + city); };
        window.addSticker = (s) => { document.getElementById('messageInput').value += s + ' '; };

        // ENVIAR MENSAJE
        window.sendMsg = async () => {
            const u = document.getElementById('userInput').value;
            const m = document.getElementById('messageInput').value;
            const p = document.getElementById('phoneInput').value;
            const t = document.getElementById('typeInput').value;
            const btn = document.getElementById('sendBtn');

            if(!u || !m) return alert("Pon tu nombre y el mensaje");

            btn.disabled = true;
            btn.innerText = "Publicando...";

            try {
                await addDoc(collection(db, "mensajes"), {
                    u: u, m: m, p: p, t: t,
                    city: currentCity,
                    time: Timestamp.now()
                });
                document.getElementById('messageInput').value = "";
                btn.disabled = false;
                btn.innerText = "PUBLICAR AHORA";
            } catch (e) {
                console.error(e);
                alert("Error: Revisa las REGLAS en Firebase");
                btn.disabled = false;
                btn.innerText = "PUBLICAR AHORA";
            }
        };

        // LEER MENSAJES EN TIEMPO REAL
        const q = query(collection(db, "mensajes"), orderBy("time", "desc"));
        onSnapshot(q, (snapshot) => {
            const container = document.getElementById('chat-container');
            container.innerHTML = "";
            snapshot.forEach((doc) => {
                const d = doc.data();
                const card = `
                    <div class="bg-white p-4 rounded-2xl shadow-md border-l-4 border-green-500 animate-fade-in">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-black text-green-700 text-sm">ğŸ‘¤ ${d.u}</span>
                            <span class="bg-green-100 text-green-800 text-[10px] px-2 py-0.5 rounded-full font-bold">${d.city}</span>
                        </div>
                        <p class="text-gray-800 text-sm mb-2">${d.m}</p>
                        <div class="flex justify-between items-center border-t pt-2">
                            <span class="text-xs font-bold text-orange-600">ğŸ·ï¸ ${d.t}</span>
                            ${d.p ? `<a href="https://wa.me/51${d.p}" target="_blank" class="bg-green-500 text-white px-3 py-1 rounded-lg text-[10px] font-bold shadow-sm">WhatsApp</a>` : ''}
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        });
    </script>
</body>
</html>
