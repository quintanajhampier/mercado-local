<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Huanta App - Mercado Total</title>
    <style>
        :root { --verde: #008f39; --esmeralda: #2ecc71; --rojo: #e74c3c; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            /* Fondo de Mercado suave */
            background-image: linear-gradient(rgba(255,255,255,0.9), rgba(255,255,255,0.9)), url('https://images.unsplash.com/photo-1533900298318-6b8da08a523e?auto=format&fit=crop&q=80&w=1000');
            background-attachment: fixed;
            background-size: cover;
        }
        header { background: var(--verde); color: white; padding: 10px; text-align: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .tabs { display: flex; overflow-x: auto; background: white; padding: 10px; gap: 8px; border-bottom: 1px solid #ddd; }
        .tab-btn { padding: 8px 15px; border-radius: 20px; border: 1px solid var(--verde); background: white; white-space: nowrap; cursor: pointer; font-size: 14px; }
        .tab-btn.active { background: var(--verde); color: white; }
        
        .sticker-bar { display: flex; overflow-x: auto; gap: 5px; padding: 10px; background: rgba(255,255,255,0.8); backdrop-filter: blur(5px); }
        .stk { background: white; border: 1px solid #ccc; border-radius: 5px; padding: 5px 10px; font-size: 12px; cursor: pointer; white-space: nowrap; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        
        #chat-box { padding: 15px; padding-bottom: 260px; }
        .msg { background: rgba(255, 255, 255, 0.95); padding: 12px; border-radius: 12px; margin-bottom: 12px; position: relative; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 6px solid var(--verde); }
        .msg.urgente { border-left-color: var(--rojo); }
        .tag { font-size: 10px; font-weight: bold; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; margin-bottom: 5px; display: inline-block; }
        .tag-venta { background: #e8f5e9; color: var(--verde); }
        .tag-aviso { background: #fff3e0; color: #ef6c00; }
        .tag-urgente { background: #ffebee; color: var(--rojo); }
        
        .user { font-weight: bold; color: #333; display: flex; align-items: center; gap: 5px; }
        .esmeralda { color: var(--esmeralda); font-size: 12px; font-weight: bold; }
        .btn-wa { display: block; background: #25d366; color: white; text-align: center; padding: 10px; border-radius: 8px; text-decoration: none; margin-top: 10px; font-weight: bold; font-size: 14px; }
        .vistas { font-size: 11px; color: #777; margin-top: 8px; text-align: right; }
        
        .footer { position: fixed; bottom: 0; width: 100%; background: white; box-sizing: border-box; border-top: 1px solid #ddd; z-index: 2000; padding-bottom: 10px; }
        .form-content { padding: 10px; }
        .inputs-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; }
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; width: 100%; box-sizing: border-box; }
        #send-btn { width: 100%; padding: 12px; background: var(--verde); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; }
        
        .media-btns { display: flex; gap: 5px; margin-bottom: 8px; }
        .m-btn { flex: 1; padding: 8px; font-size: 11px; background: #f8f9fa; border: 1px dashed #ccc; border-radius: 5px; cursor: pointer; text-align: center; }
    </style>
</head>
<body>
<header><strong>HUANTA COMUNIDAD</strong><br><small>La Esmeralda de los Andes</small></header>
<div class="tabs">
    <button class="tab-btn active" onclick="setCity('Huanta')">Huanta</button>
    <button class="tab-btn" onclick="setCity('Huamanga')">Huamanga</button>
    <button class="tab-btn" onclick="setCity('Sivia')">Sivia</button>
    <button class="tab-btn" onclick="setCity('VRAEM')">VRAEM</button>
    <button class="tab-btn" onclick="setCity('Emergencias')">üö® Emergencias</button>
</div>

<div id="chat-box"></div>

<div class="footer">
    <div class="sticker-bar">
        <div class="stk" onclick="addStk('üí∞ ¬°OFERTA √öNICA! üí∞')">üí∞ Oferta</div>
        <div class="stk" onclick="addStk('üè° TERRENO/CASA üè°')">üè° Terreno</div>
        <div class="stk" onclick="addStk('‚≠ê 100% GARANTIZADO ‚≠ê')">‚≠ê Garant√≠a</div>
        <div class="stk" onclick="addStk('üìâ ¬°PRECIO DE LOCURA! üìâ')">üìâ Rebaja</div>
        <div class="stk" onclick="addStk('‚è∞ ¬°√öLTIMOS CUPOS! ‚è∞')">‚è∞ Tiempo</div>
    </div>
    <div class="form-content">
        <div class="media-btns">
            <div class="m-btn" onclick="alert('Funcionalidad de fotos en desarrollo para la Versi√≥n 2.0')">üì∑ Subir Foto</div>
            <div class="m-btn" onclick="alert('Funcionalidad de audio en desarrollo para la Versi√≥n 2.0')">üé§ Enviar Audio</div>
        </div>
        <div class="inputs-grid">
            <input type="text" id="user" placeholder="Tu Nombre">
            <select id="tipo">
                <option value="venta">üí∞ Venta</option>
                <option value="aviso">üì¢ Aviso</option>
                <option value="urgente">üî• Urgente</option>
            </select>
        </div>
        <input type="number" id="phone" placeholder="WhatsApp (Ej: 987654321)" style="margin-bottom: 8px;">
        <input type="text" id="msg-input" placeholder="Escribe tu oferta aqu√≠..." style="margin-bottom: 8px;">
        <button id="send-btn">PUBLICAR AHORA</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, where, orderBy, onSnapshot, Timestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    
    const firebaseConfig = {
      apiKey: "AIzaSyAPKyUcP87-LUrtGP-8jiZ8T0PldVRhH9k",
      authDomain: "huanta-comunidad.firebaseapp.com",
      projectId: "huanta-comunidad",
      storageBucket: "huanta-comunidad.firebasestorage.app",
      messagingSenderId: "572754145420",
      appId: "1:572754145420:web:8021c982b3cc4a576b4ba9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let city = 'Huanta';

    window.addStk = (s) => {
        const input = document.getElementById('msg-input');
        input.value = s + " " + input.value;
    };

    window.setCity = (n) => {
        city = n;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.innerText.includes(n)));
        loadMsgs();
    };

    document.getElementById('send-btn').onclick = async () => {
        const u = document.getElementById('user').value;
        const m = document.getElementById('msg-input').value;
        const p = document.getElementById('phone').value;
        const t = document.getElementById('tipo').value;
        if(u && m) {
            await addDoc(collection(db, "mensajes"), { u, m, p, t, city, time: Timestamp.now(), vip: false, views: Math.floor(Math.random() * 50) + 10 });
            document.getElementById('msg-input').value = "";
        }
    };

    function loadMsgs() {
        const limit = new Date(); limit.setHours(limit.getHours() - 24);
        const q = query(collection(db, "mensajes"), where("city", "==", city), where("time", ">=", limit), orderBy("time", "desc"));
        onSnapshot(q, (snap) => {
            const box = document.getElementById('chat-box');
            box.innerHTML = "";
            snap.forEach(doc => {
                const d = doc.data();
                box.innerHTML += `<div class="msg ${d.t == 'urgente' ? 'urgente' : ''}">
                    <span class="tag tag-${d.t}">${d.t}</span>
                    <div class="user">${d.u} ${d.vip ? '<span class="esmeralda">üíé Esmeralda</span>' : ''}</div>
                    <div style="margin: 8px 0; color: #333; font-size: 15px;">${d.m}</div>
                    ${d.p ? `<a href="https://wa.me/51${d.p}" class="btn-wa">Escribir al WhatsApp</a>` : ''}
                    <div class="vistas">üëÅÔ∏è Visto por ${d.views} personas ‚Ä¢ ${d.time.toDate().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
                </div>`;
            });
        });
    }
    loadMsgs();
</script>
</body>
</html>
